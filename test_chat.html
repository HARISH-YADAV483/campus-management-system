<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chat Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #messages { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; }
    .user-message { color: blue; }
    .system-message { color: gray; font-style: italic; }
  </style>
</head>
<body>
  <h2>Chat Test Page</h2>
  <div id="status">Status: Connecting...</div>
  <div id="messages"></div>
  <input id="message-input" placeholder="Type a message..." />
  <button onclick="sendMessage()">Send</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const messages = document.getElementById("messages");
    const status = document.getElementById("status");

    function addMessage(text, className = "") {
      const div = document.createElement("div");
      div.className = className;
      div.innerText = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    socket.on("connect", () => {
      status.textContent = "Status: Connected";
      console.log("Socket connected:", socket.id);
    });

    socket.on("disconnect", () => {
      status.textContent = "Status: Disconnected";
    });

    socket.on("chat-message", (data) => {
      console.log("Received message:", data);
      addMessage(`[${data.time}] ${data.user}: ${data.message}`, "user-message");
    });

    socket.on("system-message", (data) => {
      console.log("System message:", data);
      addMessage(data.message, "system-message");
    });

    function sendMessage() {
      const input = document.getElementById("message-input");
      if (input.value.trim()) {
        socket.emit("chat-message", input.value);
        input.value = "";
      }
    }

    // Send message on Enter key
    document.getElementById("message-input").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        sendMessage();
      }
    });
  </script>
</body>
</html>
